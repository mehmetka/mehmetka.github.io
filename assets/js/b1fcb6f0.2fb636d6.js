"use strict";(self.webpackChunknotebook=self.webpackChunknotebook||[]).push([[294],{3905:(e,n,t)=>{t.d(n,{Zo:()=>m,kt:()=>b});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=a.createContext({}),c=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},m=function(e){var n=c(e.components);return a.createElement(l.Provider,{value:n},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,m=i(e,["components","mdxType","originalType","parentName"]),p=c(t),u=r,b=p["".concat(l,".").concat(u)]||p[u]||d[u]||o;return t?a.createElement(b,s(s({ref:n},m),{},{components:t})):a.createElement(b,s({ref:n},m))}));function b(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,s=new Array(o);s[0]=u;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i[p]="string"==typeof e?e:r,s[1]=i;for(var c=2;c<o;c++)s[c]=t[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},6819:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>c});var a=t(7462),r=(t(7294),t(3905));const o={tags:["aws"]},s="Managing PHP Sessions with DynamoDB",i={unversionedId:"technical/aws/dynamodb-managing-php-sessions",id:"technical/aws/dynamodb-managing-php-sessions",title:"Managing PHP Sessions with DynamoDB",description:"Install AWS SDK",source:"@site/docs/technical/aws/dynamodb-managing-php-sessions.md",sourceDirName:"technical/aws",slug:"/technical/aws/dynamodb-managing-php-sessions",permalink:"/technical/aws/dynamodb-managing-php-sessions",draft:!1,editUrl:"https://github.com/mehmetkanatt/notebook/blob/master/docs/technical/aws/dynamodb-managing-php-sessions.md",tags:[{label:"aws",permalink:"/tags/aws"}],version:"current",frontMatter:{tags:["aws"]},sidebar:"tutorialSidebar",previous:{title:"Accessing SecretsManager from Lambda Function in a VPC",permalink:"/technical/aws/access-secretsmanager-from-lambda-in-vpc"},next:{title:"Send Docker Images to AWS ECR",permalink:"/technical/aws/ecr-push-image"}},l={},c=[{value:"Install AWS SDK",id:"install-aws-sdk",level:2},{value:"Create Table on DynamoDB",id:"create-table-on-dynamodb",level:2},{value:"Required permissions",id:"required-permissions",level:3},{value:"Implementation",id:"implementation",level:2},{value:"Garbage Collection",id:"garbage-collection",level:2},{value:"Source:",id:"source",level:2}],m={toc:c},p="wrapper";function d(e){let{components:n,...t}=e;return(0,r.kt)(p,(0,a.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"managing-php-sessions-with-dynamodb"},"Managing PHP Sessions with DynamoDB"),(0,r.kt)("h2",{id:"install-aws-sdk"},"Install AWS SDK"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"composer require aws/aws-sdk-php  \n")),(0,r.kt)("h2",{id:"create-table-on-dynamodb"},"Create Table on DynamoDB"),(0,r.kt)("p",null,'Create a table named "sessions" on DynamoDB'),(0,r.kt)("h3",{id:"required-permissions"},"Required permissions"),(0,r.kt)("p",null,"Min required permissions listed below. Create a permission like below and attach it to DynamoDB Table"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{  \n  "Version": "2012-10-17",  \n  "Statement": [  \n    {  \n      "Action": [  \n        "dynamodb:GetItem",  \n        "dynamodb:UpdateItem",  \n        "dynamodb:DeleteItem",  \n        "dynamodb:Scan",  \n        "dynamodb:BatchWriteItem"  \n      ],  \n      "Effect": "Allow",  \n      "Resource": "arn:aws:dynamodb:region:account_id:table/sessions"  \n    }  \n  ]  \n}  \n')),(0,r.kt)("h2",{id:"implementation"},"Implementation"),(0,r.kt)("p",null,"Add below code block before session_start()"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"include_once __DIR__ . '/vendor/autoload.php';\n\nuse Aws\\DynamoDb\\DynamoDbClient;  \nuse Aws\\DynamoDb\\SessionHandler;\n\n$client = new DynamoDbClient([  \n    'region' => 'gj-oceanplanet-1',  \n    'version' => 'latest'  \n]);\n\n$sessionHandler = SessionHandler::fromClient($client, [  \n    'table_name'                    => 'sessions',  \n    'hash_key'                      => 'id',  \n    'data_attribute'                => 'data',  \n    'data_attribute_type'           => 'string',  \n    'session_lifetime'              => 3600,  \n    'session_lifetime_attribute'    => 'expires',  \n    'consistent_read'               => true,  \n    'locking'                       => false,  \n    'batch_config'                  => [],  \n    'max_lock_wait_time'            => 10,  \n    'min_lock_retry_microtime'      => 5000,  \n    'max_lock_retry_microtime'      => 50000,  \n]);\n\n$sessionHandler->register();  \n")),(0,r.kt)("h2",{id:"garbage-collection"},"Garbage Collection"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/sdk-for-php/v3/developer-guide/service_dynamodb-session-handler.html#:~:text=Setup%20a%20TTL%20attribute%20in%20your%20DynamoDB%20table%2C%20using%20the%20attribute%20%E2%80%98expires%E2%80%99.%20This%20will%20automatically%20garbage%20collect%20your%20sessions%20and%20avoid%20the%20need%20to%20garbage%20collect%20them%20yourself"},"Setup a TTL attribute in your DynamoDB table, using the attribute \u2018expires\u2019. This will automatically garbage collect",(0,r.kt)("br",{parentName:"a"}),"your sessions and avoid the need to garbage collect them yourself.")),(0,r.kt)("h2",{id:"source"},"Source:"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/sdk-for-php/v3/developer-guide/service_dynamodb-session-handler.html"},"https://docs.aws.amazon.com/sdk-for-php/v3/developer-guide/service_dynamodb-session-handler.html"),"  "),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Unknown (2022-08-13 20:52:54)",(0,r.kt)("br",{parentName:"p"}),"\n","#aws")))}d.isMDXComponent=!0}}]);