"use strict";(self.webpackChunknotebook=self.webpackChunknotebook||[]).push([[4012],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=o.createContext({}),i=function(e){var t=o.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=i(e.components);return o.createElement(c.Provider,{value:t},e.children)},s="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},k=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,c=e.parentName,u=p(e,["components","mdxType","originalType","parentName"]),s=i(n),k=r,d=s["".concat(c,".").concat(k)]||s[k]||m[k]||a;return n?o.createElement(d,l(l({ref:t},u),{},{components:n})):o.createElement(d,l({ref:t},u))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,l=new Array(a);l[0]=k;var p={};for(var c in t)hasOwnProperty.call(t,c)&&(p[c]=t[c]);p.originalType=e,p[s]="string"==typeof e?e:r,l[1]=p;for(var i=2;i<a;i++)l[i]=n[i];return o.createElement.apply(null,l)}return o.createElement.apply(null,n)}k.displayName="MDXCreateElement"},3082:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>m,frontMatter:()=>a,metadata:()=>p,toc:()=>i});var o=n(7462),r=(n(7294),n(3905));const a={tags:["curl","php","phpfpm"]},l=void 0,p={unversionedId:"technical/php",id:"technical/php",title:"php",description:"Enable slowlog",source:"@site/docs/technical/php.md",sourceDirName:"technical",slug:"/technical/php",permalink:"/technical/php",draft:!1,editUrl:"https://github.com/mehmetka/notebook/blob/master/docs/technical/php.md",tags:[{label:"curl",permalink:"/tags/curl"},{label:"php",permalink:"/tags/php"},{label:"phpfpm",permalink:"/tags/phpfpm"}],version:"current",frontMatter:{tags:["curl","php","phpfpm"]},sidebar:"tutorialSidebar",previous:{title:"mysql",permalink:"/technical/mysql"},next:{title:"security",permalink:"/category/security"}},c={},i=[{value:"Enable slowlog",id:"enable-slowlog",level:2},{value:"Log Fatal Errors to Different Log File",id:"log-fatal-errors-to-different-log-file",level:2},{value:"cURL: Not async",id:"curl-not-async",level:2},{value:"cURL: Async",id:"curl-async",level:2},{value:"Modifying PHP-FPM Access Log Format",id:"modifying-php-fpm-access-log-format",level:2},{value:"Fix: PHP7.1-FPM + Apache &quot;Gateway Timeout&quot;",id:"fix-php71-fpm--apache-gateway-timeout",level:2},{value:"Fix: PHP7.4-FPM + Apache &quot;Gateway Timeout 504&quot;",id:"fix-php74-fpm--apache-gateway-timeout-504",level:2},{value:"Run composer commands on disposable Docker container",id:"run-composer-commands-on-disposable-docker-container",level:2}],u={toc:i},s="wrapper";function m(e){let{components:t,...n}=e;return(0,r.kt)(s,(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"enable-slowlog"},"Enable slowlog"),(0,r.kt)("p",null,'Add to your custom "www.conf"'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"slowlog = /var/log/php-fpm/www.log  \nrequest_slowlog_timeout = 30s  \n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Unknown (2023-09-25 15:47:47)",(0,r.kt)("br",{parentName:"p"}),"\n","#phpfpm")),(0,r.kt)("p",null,"--"),(0,r.kt)("h2",{id:"log-fatal-errors-to-different-log-file"},"Log Fatal Errors to Different Log File"),(0,r.kt)("p",null,"Change these fields in php.ini file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"log_errors = on  \nerror_reporting = E_ERROR  \nerror_log = /path/to/file  \n")),(0,r.kt)("p",null,"Source: ",(0,r.kt)("a",{parentName:"p",href:"https://mediatemple.net/community/products/dv/360020711631/how-to-enable-php-error-logging-via-php.ini"},"https://mediatemple.net/community/products/dv/360020711631/how-to-enable-php-error-logging-via-php.ini"),"  "),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Unknown (2022-08-13 21:05:22)",(0,r.kt)("br",{parentName:"p"}),"\n","#php")),(0,r.kt)("p",null,"--"),(0,r.kt)("h2",{id:"curl-not-async"},"cURL: Not async"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"exec('curl http://example.com');  \n")),(0,r.kt)("h2",{id:"curl-async"},"cURL: Async"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"exec('curl http://example.com > /dev/null 2>/dev/null &');  \n")),(0,r.kt)("p",null,'You can see running processes with "ps -ef"  '),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Unknown (2023-09-07 12:09:40)",(0,r.kt)("br",{parentName:"p"}),"\n","#curl #php")),(0,r.kt)("p",null,"--"),(0,r.kt)("h2",{id:"modifying-php-fpm-access-log-format"},"Modifying PHP-FPM Access Log Format"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'access.format = "[%t] %m %{REQUEST_SCHEME}e://%{HTTP_HOST}e%{REQUEST_URI}e pid:%p took:%ds mem:%{mega}Mmb cpu:%C%% status:%s {%{REMOTE_ADDR}e|%{HTTP_USER_AGENT}e}"  \n')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Unknown (2023-08-15 22:11:48)",(0,r.kt)("br",{parentName:"p"}),"\n","#php")),(0,r.kt)("p",null,"--"),(0,r.kt)("h2",{id:"fix-php71-fpm--apache-gateway-timeout"},'Fix: PHP7.1-FPM + Apache "Gateway Timeout"'),(0,r.kt)("p",null,"Add ",(0,r.kt)("inlineCode",{parentName:"p"},"Timeout 600")," this statement to global conf."),(0,r.kt)("h2",{id:"fix-php74-fpm--apache-gateway-timeout-504"},'Fix: PHP7.4-FPM + Apache "Gateway Timeout 504"'),(0,r.kt)("p",null,"Add ",(0,r.kt)("inlineCode",{parentName:"p"},"timeout=600")," this statement to end of ProxyPassMatch line's  "),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Unknown (2023-08-17 17:11:26)",(0,r.kt)("br",{parentName:"p"}),"\n","#php")),(0,r.kt)("p",null,"--"),(0,r.kt)("p",null,"Using getenv() and putenv() is strongly discouraged due to the fact that these functions are not thread safe, however it is still possible to instruct PHP dotenv to use these functions.  "),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Unknown (2022-08-13 21:08:33)",(0,r.kt)("br",{parentName:"p"}),"\n","#php")),(0,r.kt)("p",null,"--"),(0,r.kt)("h2",{id:"run-composer-commands-on-disposable-docker-container"},"Run composer commands on disposable Docker container"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"docker run --rm --interactive --tty --volume $PWD:/app composer  \n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Unknown (2022-08-13 21:05:33)",(0,r.kt)("br",{parentName:"p"}),"\n","#php")))}m.isMDXComponent=!0}}]);